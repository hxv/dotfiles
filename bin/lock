#!/usr/bin/env bash
# Author: Dolores Portalatin <hello@doloresportalatin.info>
# Dependencies: imagemagick, i3lock-color-git, scrot
set -o errexit -o noclobber -o nounset -o pipefail

echo 'Screen locked' | logger -t 'i3-lock'

IMAGE="$(mktemp).png"

trap 'rm -f "$IMAGE"' EXIT

scrot -z "$IMAGE"

SCALE=5
convert "$IMAGE" -contrast -scale $(echo "100 / $SCALE" | bc -l)% -scale $(echo "100 * $SCALE" | bc -l)% -statistic median 5x5 "$IMAGE"

i3lock -n -i "$IMAGE"

echo 'Screen unlocked' | logger -t 'i3-lock'
